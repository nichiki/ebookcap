# 📚 ebookcap – 電子書籍キャプチャツール

macOS および Windows 上で動作する、電子書籍ビューアのウィンドウを自動でキャプチャし、ページごとに画像として保存、そして PDF に変換するツールです。
表紙から巻末まで、任意のページ数を連続でキャプチャして、読みやすい PDF として書き出すことができます。

---

## 🛠 インストール

このツールは Python 3.9 以上が必要です。

### 1. 仮想環境の作成

#### macOS/Linux
```bash
python -m venv .venv
source .venv/bin/activate
```

#### Windows
```bat
python -m venv .venv
.venv\Scripts\activate
```

### 2. 依存関係のインストール

OSに応じて必要なライブラリだけが自動でインストールされます。

```bash
pip install -r requirements.txt
```

`requirements.txt` に含まれる主なライブラリ：

* `pyautogui`
* `pywinctl`
* `pyobjc`（macOSのみ自動インストール）
* `pillow`
* `tqdm`

---

## 📦 使い方

---

### 📝 使い方の流れ（下準備と操作手順）

1. **キャプチャしたい電子書籍ビューアなどのウインドウをあらかじめ開いておきます。**
2. **コマンドを実行すると、現在開いているウインドウの一覧が表示されます。**
   例：
   ```
   📚 キャプチャ対象のウィンドウを選んでください：

   [0] Google - Brave
   [1] Kindle
   番号を入力:
   ```
3. **キャプチャしたいウインドウの番号を入力して選択します。**
4. **選択後、自動的にページキャプチャが開始されます。**

---

#### トリミングについて

- 必要に応じて、キャプチャ画像の上下左右をトリミングすることができます。
- 一括指定（例：`--trim 60,40,10,10`）や、個別指定（`--trim-top` など）で細かく調整可能です。

---

### コマンド構文

```bash
python main.py capture [オプション]
```

### 主なオプション

| オプション            | 説明                                     |
| ---------------- | -------------------------------------- |
| `--pages`, `-p`  | 撮影するページ数または自動判定（例：`--pages 20` または `--pages auto`） |
| `--interval`     | ページ送りの待ち時間（秒）                          |
| `--key`          | ページ送りに使うキー（例：`right`, `left`, `space`） |
| `--output`, `-o` | 保存先フォルダ（デフォルト：デスクトップの ebook-capture フォルダ）                  |
| `--trim`         | トリミング一括指定（例：`--trim 60,40,10,10`）      |
| `--trim-top` 等   | 上下左右を個別に指定（`--trim` と併用不可）             |
| `--no-pdf`       | PDF作成を無効化（PNGのみ保存）                     |

#### `--pages` オプションについて

- デフォルトは `1` です。
- 数字または `auto` を指定できます。
- 数字の場合、その回数分ページ送りとキャプチャを実行します。
- `auto` の場合、同じ画像がキャプチャされた時点で自動的に終了します（ページ数が分からないリフロー型電子書籍などに便利です）。

---

#### `--key` オプションについて

- ページ送りに使うキーを指定します。デフォルトは `right` です。
- 例：`--key left` や `--key space` など
- 利用可能なキー一覧は以下のコマンドで確認できます：

```bash
python -c "import pyautogui; print(pyautogui.KEYBOARD_KEYS)"
```

主なキー名例：`right`, `left`, `space`, `enter` など

---

### 📄 PDFのみを再作成したい場合

すでに PNG があるフォルダから、PDFだけ作り直すには：

```bash
python main.py pdf-only --input ./ebook-capture
```

---

## 🧷 使い方の例

```bash
python main.py capture -p 10 --trim 60,40,10,10
```

→ 10ページ分キャプチャ、指定したトリミングで切り抜き、PDFも出力されます。

---

## ⚙️ OSごとの動作について

### macOS
- ウィンドウのキャプチャにはmacOS標準の`screencapture`コマンドを利用します。
- Retinaディスプレイにも対応し、高精細な画像が得られます。

### Windows
- `pywinctl`でウィンドウの位置とサイズを取得し、`pyautogui.screenshot(region=...)`でその領域をキャプチャします。
- ウィンドウが他のウィンドウに隠れている場合は、そのまま隠れた状態でキャプチャされます。
- DPIスケーリングが100%であれば、より正確なキャプチャが可能です。

---

## ⚠️ 免責事項・注意事項

* **本ツールは、個人利用・研究・バックアップを目的とした利用を前提としています。**
* **著作権で保護されたコンテンツを複製・再配布する行為には、各自の責任のもと十分に注意してください。**
* **このツールを使用して生じたいかなる損害やトラブルについても、作成者は一切の責任を負いません。**
* **現在は macOS および Windows のみ対応しています。Linux では動作しません。**

---

## 💬 ライセンス

このツールは MIT ライセンスの下で配布されています。詳しくはリポジトリ内の LICENSE ファイルをご覧ください。
